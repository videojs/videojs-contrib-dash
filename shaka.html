<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Test Player</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width">

  <link rel="stylesheet" href="node_modules/video.js/dist/video-js.css">
  <script src="node_modules/video.js/dist/ie8/videojs-ie8.js"></script>
</head>

<body>
  <video id="player" width=600 height=300 class="video-js vjs-default-skin" controls></video>

  <label>Rendition: <select class="quality-switcher"></select> </label>
  <table id='reps'>
    <tr>
      <th>Enabled</th>
      <th>ID</th>
      <th>Width</th>
      <th>Height</th>
      <th>Bandwidth</th>
    </tr>
  </div>

  <script src="node_modules/video.js/dist/video.js"></script>
  <script src="node_modules/shaka-player/dist/shaka-player.compiled.js"></script>
  <script src="dist/videojs-shaka.js"></script>

  <script>
    var player = videojs('player', { nativeCpations: false });

    player.ready(function(){
      var updateTable = function(){
        if (!player.dash) return;

        var table = document.getElementById('reps');
        table.innerHTML='';

        player.dash.representations().forEach(function(rep) {
          var
            tr = document.createElement('tr'),
            checkbox = document.createElement('input'),
            checkboxTd = document.createElement('td'),
            idTd = document.createElement('td'),
            widthTd = document.createElement('td'),
            heightTd = document.createElement('td'),
            bandwidthTd = document.createElement('td');

          checkbox.checked = rep.enabled();
          checkbox.type = 'checkbox';
          checkbox.onclick = function() {
            if (checkbox.checked) {
              rep.enabled(true);
            } else {
              rep.enabled(false);
            }
          };
          checkboxTd.appendChild(checkbox);

          idTd.innerHTML = rep.id;
          widthTd.innerHTML = rep.width;
          heightTd.innerHTML = rep.height;
          bandwidthTd.innerHTML = rep.bandwidth;

          tr.appendChild(checkboxTd);
          tr.appendChild(idTd);
          tr.appendChild(widthTd);
          tr.appendChild(heightTd);
          tr.appendChild(bandwidthTd);

          table.appendChild(tr);
        });
      };

      // setup dropdown
      var selectControl = document.querySelector('.quality-switcher');

      // set quality on selection
      selectControl.addEventListener('change', function(event) {
        var targetId = event.target.value;
        var auto = targetId === 'auto';
        if (player && player.dash) {
          player.dash.representations().forEach(function(rep) {
            if (rep.id) {
              rep.enabled(auto || targetId === rep.id);
            }
          });
        }

        updateTable();
      });

      player.on('loadedmetadata', function() {
        if (!player.dash) return;

        updateTable();

        // update dropdown
        //
        // remove existing quality items
        selectControl.innerHTML = '';

        // add new quality items and an auto option
        [{id: 'auto', text: 'auto'}]
          .concat(player.dash.representations())
          .forEach(function(rep) {
            var option = document.createElement('option');
            option.value = rep.id;
            option.text = rep.text || 'Height: ' + rep.height + ', Bandwidth: ' + rep.bandwidth;
            selectControl.appendChild(option);
          });
      });

      player.src({
        src: '//storage.googleapis.com/shaka-demo-assets/angel-one/dash.mpd',
        type: 'application/dash+xml'
      });
    });
  </script>
</body>

</html>
