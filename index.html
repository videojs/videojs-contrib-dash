<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Test Player</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width">

  <link rel="stylesheet" href="node_modules/video.js/dist/video-js.css">
  <script src="node_modules/video.js/dist/ie8/videojs-ie8.js"></script>
</head>

<body>
  <video id="player" width=600 height=300 class="video-js vjs-default-skin" controls></video>
  <label>Rendition: <select class="quality-switcher"></select> </label>
  <form id=load-url>
    <label> Video URL: <input id=url type=url value="http://dash.edgesuite.net/akamai/bbb_30fps/bbb_30fps.mpd"> </label> <br>
    <label> Widevine License URL: <input id=wvServer type=url value=""> </label><br>
    <label> PlayReady License URL: <input id=prServer type=url value=""> </label><br>
    <button type=submit>Load</button>
  </form>

  <script src="node_modules/video.js/dist/video.js"></script>
  <script src="node_modules/dashjs/dist/dash.all.debug.js"></script>
  <script src="dist/videojs-dash.js"></script>

  <script>
    var player = videojs('player', {
      sources: [{
        src: 'http://dash.edgesuite.net/akamai/bbb_30fps/bbb_30fps.mpd',
        type: 'application/dash+xml'
      }]
    });

    // set up dropdown
    (function(player) {
      var selectControl = document.querySelector('.quality-switcher');

      // set quality on selection
      selectControl.addEventListener('change', function(event) {
        var targetId = event.target.value;
        var auto = targetId === 'auto';
        if (player && player.dash) {
          player.dash.representations().forEach(function(rep) {
            if (rep.id) {
              rep.enabled(auto || targetId === rep.id);
            }
          });
        }
      });

      player.on('loadedmetadata', function() {
        if (!player.dash) return;

        // update dropdown
        // remove existing quality items
        selectControl.innerHTML = '';

        // add new quality items and an auto option
        [{
          id: 'auto',
          text: 'auto'
        }].concat(player.dash.representations())
          .forEach(function(rep) {
            var option = document.createElement('option');
            option.value = rep.id;
            option.text = rep.text || 'Height: ' + rep.height + ', Bandwidth: ' + rep.bandwidth;
            selectControl.appendChild(option);
          });
      });
    })(player);

    // set up the video switcher
    (function(player) {
      var loadUrl = document.getElementById('load-url');
      loadUrl.addEventListener('submit', function(event) {
        event.preventDefault();

        var wvServer = document.getElementById('wvServer');
        var prServer = document.getElementById('prServer');
        var src = {
          src: url.value,
          type: 'application/dash+xml'
        };

        if (wvServer.value || prServer.value) {
          src.keySystemOptions = [];

          if (wvServer.value) {
            src.keySystemOptions.push({
              name: 'com.widevine.alpha',
              options: {
                serverURL: wvServer.value
              }
            });
          }

          if (prServer.value) {
            src.keySystemOptions.push({
              name: 'com.microsoft.playready',
              options: {
                serverURL: prServer.value
              }
            });
          }
        }

        player.src(src);

        return false;
      });
    })(player);
  </script>
</body>

</html>